<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Sam Benning">
<meta name="dcterms.date" content="2024-11-20">

<title>Many Paths to the Same Destination: The Celtics’ Different Lineups This Season – Sports Data Analysis Blog</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Sports Data Analysis Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/sbenning7"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Many Paths to the Same Destination: The Celtics’ Different Lineups This Season</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">basketball</div>
                <div class="quarto-category">NBA</div>
                <div class="quarto-category">Celtics</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Sam Benning </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">November 20, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>The Boston Celtics have been one of the best teams in the league this year, notably taking down the previously 15-0 Cavaliers. They are strong favorites to repeat as NBA champions. They haven’t had much turnover of their roster from last year, but there has been some shift in their lineups and minutes. Again, regardless of this shift, they still have had immense success in their first part of the 2024-25 season. So, what are their secrets? Today we will be looking into the Celtics lineups and will try to figure out what their recipe is to try and be back-to-back world champs. Data will be accessed through the hoopR library.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.1
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hoopR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>team_id <span class="ot">&lt;-</span> <span class="dv">1610612738</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>lineups <span class="ot">&lt;-</span> <span class="fu">nba_leaguedashlineups</span>(<span class="at">team_id =</span> team_id, <span class="at">season =</span> <span class="st">"2024-25"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>current_celtics <span class="ot">&lt;-</span> lineups[[<span class="dv">1</span>]]</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>current_celtics <span class="ot">&lt;-</span> current_celtics <span class="sc">|&gt;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="dv">6</span><span class="sc">:</span><span class="dv">57</span>, <span class="sc">~</span><span class="fu">as.numeric</span>(<span class="fu">as.character</span>(.)))</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><u>Just to do some exploratory analysis:</u></p>
<p>Looking at the plus-minus of every lineup that has played &gt;12 minutes (equivalent to 1 quarter) together this season, we can take a look at our best lineups by plus-minus, which is the differential that their team achieved while a group was on the floor.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>current_celtics <span class="sc">|&gt;</span> <span class="fu">filter</span>(MIN <span class="sc">&gt;</span> <span class="fl">12.0</span>) <span class="sc">|&gt;</span> <span class="fu">group_by</span>(GROUP_NAME) <span class="sc">|&gt;</span> <span class="fu">summarize</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">gp =</span> GP,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">pm =</span> PLUS_MINUS,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">min =</span> MIN,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">pm48 =</span> (pm<span class="sc">/</span>min)<span class="sc">*</span><span class="dv">48</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(pm48))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 × 5
   GROUP_NAME                                              gp    pm   min   pm48
   &lt;chr&gt;                                                &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
 1 J. Tatum - D. White - N. Queta - P. Pritchard - S. …     6    17  17.5  46.7 
 2 J. Tatum - L. Kornet - P. Pritchard - S. Hauser - J…     5    16  25.2  30.5 
 3 J. Tatum - D. White - L. Kornet - P. Pritchard - S.…     4     9  16.2  26.7 
 4 A. Horford - J. Holiday - J. Tatum - D. White - N. …     4    20  39.1  24.6 
 5 J. Holiday - J. Brown - J. Tatum - D. White - N. Qu…     3     8  17.2  22.4 
 6 A. Horford - J. Holiday - J. Brown - J. Tatum - D. …     8    60 137.   21.0 
 7 J. Holiday - J. Brown - J. Tatum - D. White - L. Ko…     3     8  19.7  19.5 
 8 J. Brown - J. Tatum - D. White - N. Queta - P. Prit…     6     7  17.8  18.9 
 9 A. Horford - J. Holiday - J. Tatum - D. White - L. …     3     6  18.0  16.0 
10 J. Holiday - J. Brown - J. Tatum - L. Kornet - P. P…     4     4  12.6  15.2 
11 J. Brown - J. Tatum - D. White - L. Kornet - P. Pri…     6    -1  14.4  -3.34
12 A. Horford - J. Brown - J. Tatum - D. White - N. Qu…     2    -4  22.8  -8.42
13 J. Brown - D. White - N. Queta - P. Pritchard - S. …     5    -5  19.6 -12.3 
14 J. Holiday - D. White - L. Kornet - P. Pritchard - …     4   -12  18.5 -31.2 
15 J. Holiday - J. Tatum - N. Queta - P. Pritchard - S…     5   -14  18.8 -35.7 </code></pre>
</div>
</div>
<p>I created a new statistic that I call plus-minus per 48 minutes, which is essentially the expected differential of a lineup over an opponent if they played an entire game together. While a bit unrealistic, I find it to give us a good idea of how solid a lineup may be, instead of looking at small, wacky numbers.</p>
<p>Our best pm48 lineup is the only lineup that includes Jordan Walsh, interestingly enough. They would be expected to defeat a team by almost 47 points if they played a full game together, which is whopping. They have only played 17 minutes all together, but maybe they should play a little more. Overall, it’s very nice to see that there is a good distribution of lineups that all can get it done, whether we have Tatum in or Brown in (or both).</p>
<p>The Celtics have led the league in 3PM this year. Let’s take a look at who plays the biggest part in making that happen.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>current_celtics <span class="sc">|&gt;</span> <span class="fu">filter</span>(MIN <span class="sc">&gt;</span> <span class="fl">12.0</span>) <span class="sc">|&gt;</span> <span class="fu">group_by</span>(GROUP_NAME) <span class="sc">|&gt;</span> <span class="fu">summarize</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">min =</span> MIN,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">3pm</span><span class="st">`</span> <span class="ot">=</span> FG3M,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">3pa</span><span class="st">`</span> <span class="ot">=</span> FG3A,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">3pct</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">100</span><span class="sc">*</span>(FG3_PCT)) <span class="sc">|&gt;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="st">`</span><span class="at">3pct</span><span class="st">`</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 × 5
   GROUP_NAME                                             min `3pm` `3pa` `3pct`
   &lt;chr&gt;                                                &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
 1 A. Horford - J. Holiday - J. Brown - J. Tatum - D. … 137.     67   134   50  
 2 J. Brown - D. White - N. Queta - P. Pritchard - S. …  19.6     6    12   50  
 3 J. Brown - J. Tatum - D. White - L. Kornet - P. Pri…  14.4     6    12   50  
 4 J. Tatum - D. White - L. Kornet - P. Pritchard - S.…  16.2     9    18   50  
 5 J. Tatum - D. White - N. Queta - P. Pritchard - S. …  17.5     7    14   50  
 6 J. Holiday - J. Brown - J. Tatum - D. White - N. Qu…  17.2     7    16   43.8
 7 A. Horford - J. Holiday - J. Tatum - D. White - L. …  18.0     8    21   38.1
 8 A. Horford - J. Brown - J. Tatum - D. White - N. Qu…  22.8     9    24   37.5
 9 J. Brown - J. Tatum - D. White - N. Queta - P. Prit…  17.8     6    16   37.5
10 J. Tatum - L. Kornet - P. Pritchard - S. Hauser - J…  25.2    13    35   37.1
11 A. Horford - J. Holiday - J. Tatum - D. White - N. …  39.1    16    44   36.4
12 J. Holiday - J. Brown - J. Tatum - D. White - L. Ko…  19.7     6    17   35.3
13 J. Holiday - J. Brown - J. Tatum - L. Kornet - P. P…  12.6     4    15   26.7
14 J. Holiday - J. Tatum - N. Queta - P. Pritchard - S…  18.8     6    23   26.1
15 J. Holiday - D. White - L. Kornet - P. Pritchard - …  18.5     5    20   25  </code></pre>
</div>
</div>
<p>The current NBA league average is 35.7% from three. Of our 14 different lineups that have played &gt;12 minutes (aka 1 quarter), 10 of them shoot above the league average. You could pretty much put any of our “usual” groups in there and be pretty confident that they will be a threat from beyond the arc. This must be frustrating for any team who may be trying to target specific lineups or players - they don’t really get a break from our bombardment of threes.</p>
<p>Defensively, our Celtics are relatively middle-of-the pack. I would love to see which lineups are/aren’t giving up buckets to other teams.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>current_celtics <span class="sc">|&gt;</span> <span class="fu">filter</span>(MIN <span class="sc">&gt;</span> <span class="fl">12.0</span>) <span class="sc">|&gt;</span> <span class="fu">group_by</span>(GROUP_NAME) <span class="sc">|&gt;</span> <span class="fu">summarize</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">g =</span> GP,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">min =</span> MIN,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">papg =</span> <span class="sc">-</span><span class="dv">48</span><span class="sc">*</span>((PLUS_MINUS <span class="sc">-</span> PTS)<span class="sc">/</span>min)) <span class="sc">|&gt;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(papg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 × 4
   GROUP_NAME                                                      g   min  papg
   &lt;chr&gt;                                                       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 J. Holiday - J. Brown - J. Tatum - D. White - L. Kornet         3  19.7  87.8
 2 J. Brown - J. Tatum - D. White - N. Queta - P. Pritchard        6  17.8  94.5
 3 A. Horford - J. Holiday - J. Tatum - D. White - L. Kornet       3  18.0  96.1
 4 J. Holiday - J. Brown - J. Tatum - L. Kornet - P. Pritchard     4  12.6  99.1
 5 A. Horford - J. Holiday - J. Tatum - D. White - N. Queta        4  39.1 101. 
 6 J. Tatum - D. White - N. Queta - P. Pritchard - S. Hauser       6  17.5 104. 
 7 A. Horford - J. Holiday - J. Brown - J. Tatum - D. White        8 137.  111. 
 8 J. Holiday - D. White - L. Kornet - P. Pritchard - S. Haus…     4  18.5 114. 
 9 J. Tatum - L. Kornet - P. Pritchard - S. Hauser - J. Walsh      5  25.2 114. 
10 J. Tatum - D. White - L. Kornet - P. Pritchard - S. Hauser      4  16.2 116. 
11 J. Holiday - J. Brown - J. Tatum - D. White - N. Queta          3  17.2 118. 
12 A. Horford - J. Brown - J. Tatum - D. White - N. Queta          2  22.8 118. 
13 J. Holiday - J. Tatum - N. Queta - P. Pritchard - S. Hauser     5  18.8 120. 
14 J. Brown - J. Tatum - D. White - L. Kornet - P. Pritchard       6  14.4 127. 
15 J. Brown - D. White - N. Queta - P. Pritchard - S. Hauser       5  19.6 142. </code></pre>
</div>
</div>
<p>Starters + Kornet seems to be our best.</p>
<p>Now, let’s look at the big picture. I am going to look at our 5 most utilized lineups and see where our strengths and weaknesses lie. A radar chart will help us measure a number of selected stats and compare lineups to each other based upon our selection.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fmsb)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter and summarize per-48 stats for lineups with MIN &gt; 20.0</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>celtics_radar <span class="ot">&lt;-</span> current_celtics <span class="sc">|&gt;</span> </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(MIN <span class="sc">&gt;</span> <span class="fl">19.6</span>) <span class="sc">|&gt;</span> </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GROUP_NAME) <span class="sc">|&gt;</span> </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">ppg =</span> <span class="fu">round</span>((PTS <span class="sc">/</span> MIN) <span class="sc">*</span> <span class="dv">48</span>, <span class="dv">1</span>),</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">apg =</span> <span class="fu">round</span>((AST <span class="sc">/</span> MIN) <span class="sc">*</span> <span class="dv">48</span>, <span class="dv">1</span>),</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">rpg =</span> <span class="fu">round</span>((REB <span class="sc">/</span> MIN) <span class="sc">*</span> <span class="dv">48</span>, <span class="dv">1</span>),</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">topg =</span> <span class="fu">round</span>((TOV <span class="sc">/</span> MIN) <span class="sc">*</span> <span class="dv">48</span>, <span class="dv">1</span>),</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">papg =</span> <span class="fu">round</span>(((PLUS_MINUS <span class="sc">-</span> PTS)<span class="sc">/</span>MIN) <span class="sc">*</span> <span class="sc">-</span><span class="dv">48</span>, <span class="dv">1</span>),</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">spg =</span> <span class="fu">round</span>((STL <span class="sc">/</span> MIN) <span class="sc">*</span> <span class="dv">48</span>, <span class="dv">1</span>),</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">bpg =</span> <span class="fu">round</span>((BLK <span class="sc">/</span> MIN) <span class="sc">*</span> <span class="dv">48</span>, <span class="dv">1</span>)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lineupnames =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    GROUP_NAME <span class="sc">==</span> <span class="st">"A. Horford - J. Brown - J. Tatum - D. White - N. Queta"</span> <span class="sc">~</span> <span class="st">"Horford, Brown, Tatum, White, Queta"</span>,</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    GROUP_NAME <span class="sc">==</span> <span class="st">"A. Horford - J. Holiday - J. Brown - J. Tatum - D. White"</span> <span class="sc">~</span> <span class="st">"Horford, Holiday, Brown, Tatum, White"</span>,</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    GROUP_NAME <span class="sc">==</span> <span class="st">"A. Horford - J. Holiday - J. Tatum - D. White - N. Queta"</span> <span class="sc">~</span> <span class="st">"Horford, Holiday, Tatum, White, Queta"</span>,</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    GROUP_NAME <span class="sc">==</span> <span class="st">"J. Holiday - J. Brown - J. Tatum - D. White - L. Kornet"</span> <span class="sc">~</span> <span class="st">"Holiday, Brown, Tatum, White, Kornet"</span>,</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    GROUP_NAME <span class="sc">==</span> <span class="st">"J. Tatum - L. Kornet - P. Pritchard - S. Hauser - J. Walsh"</span> <span class="sc">~</span> <span class="st">"Tatum, Kornet, Pritchard, Hauser, Walsh"</span>,</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> GROUP_NAME  <span class="co"># Keep other values unchanged</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare max and min values for radar chart scaling</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>max_vals <span class="ot">&lt;-</span> <span class="fu">apply</span>(celtics_radar[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">9</span>)], <span class="dv">2</span>, max)  <span class="co"># Exclude GROUP_NAME and lineupnames</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>min_vals <span class="ot">&lt;-</span> <span class="fu">apply</span>(celtics_radar[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">9</span>)], <span class="dv">2</span>, min)  <span class="co"># Exclude GROUP_NAME and lineupnames</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine data for radar chart</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>radar_data_scaled <span class="ot">&lt;-</span> <span class="fu">rbind</span>(max_vals, min_vals, celtics_radar[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">9</span>)])</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify custom fill colors</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>custom_fill_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adjustcolor</span>(<span class="st">"#007A33"</span>, <span class="at">alpha.f =</span> <span class="fl">0.5</span>),  <span class="co"># Celtics Green</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adjustcolor</span>(<span class="st">"grey"</span>, <span class="at">alpha.f =</span> <span class="fl">0.5</span>),  <span class="co"># Silver</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adjustcolor</span>(<span class="st">"#FFD700"</span>, <span class="at">alpha.f =</span> <span class="fl">0.5</span>),  <span class="co"># Gold</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adjustcolor</span>(<span class="st">"#191970"</span>, <span class="at">alpha.f =</span> <span class="fl">0.5</span>),  <span class="co"># Midnight Blue</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adjustcolor</span>(<span class="st">"#DC143C"</span>, <span class="at">alpha.f =</span> <span class="fl">0.5</span>)   <span class="co"># Crimson Red</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure the number of fill colors matches the number of lineups</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>fill_colors <span class="ot">&lt;-</span> <span class="fu">rep</span>(custom_fill_colors, <span class="at">length.out =</span> <span class="fu">nrow</span>(celtics_radar))</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot radar chart</span></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a><span class="fu">radarchart</span>(</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>  radar_data_scaled,</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">axistype =</span> <span class="dv">2</span>,</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">pcol =</span> custom_fill_colors,      <span class="co"># Line colors for each lineup</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">plwd =</span> <span class="dv">2</span>,                <span class="co"># Line width</span></span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">pfcol =</span> custom_fill_colors,     <span class="co"># Fill colors for each lineup</span></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">cglcol =</span> <span class="st">"grey"</span>,         <span class="co"># Grid line color</span></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">vlcex =</span> <span class="fl">0.8</span>              <span class="co"># Variable label size</span></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"Celtics lineups can't have everything, but still get a lot"</span>,  <span class="co"># Title</span></span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>  <span class="at">sub =</span> <span class="st">"Per-48 Minute Stats for Celtics' 5 most-played lineups shows tradeoffs, but a solid baseline."</span>,  <span class="co"># Subtitle</span></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>  <span class="at">cex.main =</span> <span class="fl">1.5</span>,  <span class="co"># Size of the main title</span></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>  <span class="at">cex.sub =</span> <span class="dv">1</span>    <span class="co"># Size of the subtitle</span></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Add legend</span></span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(</span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fl">1.3</span>, <span class="at">y =</span> <span class="fl">1.3</span>,  <span class="co"># Adjust position using relative coordinates</span></span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend =</span> celtics_radar<span class="sc">$</span>lineupnames,  <span class="co"># Use updated lineup names</span></span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> fill_colors,                   <span class="co"># Match colors</span></span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>  <span class="at">lty =</span> <span class="dv">1</span>,                             <span class="co"># Line type</span></span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="dv">2</span>,                             <span class="co"># Line width</span></span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>  <span class="at">cex =</span> <span class="fl">0.4</span>                            <span class="co"># Text size</span></span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Looking at these different lineups, we clearly can’t get everything we want in every combination of players. However, certain lineups truly excel at specific things, for example, Holiday-Brown-Tatum-White-Kornet are clearly the best defensive lineup that we have.</p>
<p>I would consider our starting lineup (in gray) to be a solid baseline: solid scoring, low turnovers, solid defense. It struggles with rebounding the ball (which has been the problem for years upon end, don’t even get me started), but makes up with everything else.</p>
<p>What initially may look like our “worst” lineup on paper in yellow, may actually be our best, as it is most consistent. I find that it may even be better than our starting lineup. It has a great distribution of passing, rebounding, and scoring while limiting turnovers and opponent points. Again, it may not excel in anything in particular, but it is important to note that those lineups that have really gone above and beyond are truly insane numbers, so a value that is on the inside on isn’t actually that bad. I didn’t expect Queta for Brown to be a substitution that may enhance our lineup, but maybe this is a better fit given that Tatum and Brown do pretty much the same thing, while Queta brings an interior/defensive presence that no other Celtics big has. Having Payton Pritchard in that red lineup certainly helps with scoring - he has the most confidence in his shooting than anyone else on the team, and I’m sure that rubs off on his teammates while he’s on the floor.</p>
<p>In my opinion, this chart also gives insight about how our other bench pieces fit in with our team, which may reflect their expected roles as well. With our red lineup, I would expect Hauser and Walsh to simply be in the game just to score - who cares about defense or anything else, just get buckets - we see this through their high scoring but not many other good stats. On the other hand, I see Kornet and Queta in to control the interior (as I mentioned with regards to Queta). It’s very interesting how this chart can give more interpretation than just a holistic viewpoint; it can provide us with maybe some deeper stories to uncover with the flow of our repeat champion hopefuls.</p>
<p>This was a tough statistical measure to analyze - it requires some guessing, assumptions, and overall knowledge. I can’t rely as heavily on the numbers as I would for any other analysis. It makes me wonder how much coaching staffs balance the eye test versus these numbers as well when deciding who to play. Might be time for more research.</p>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>